(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{141:function(e,o,t){"use strict";t.r(o);var s=t(0),a=Object(s.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"playbooks-for-installing-prometheus-and-grafana-on-kubernetes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#playbooks-for-installing-prometheus-and-grafana-on-kubernetes","aria-hidden":"true"}},[e._v("#")]),e._v(" Playbooks for installing Prometheus and Grafana on Kubernetes")]),t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[e._v("#")]),e._v(" Prerequisites")]),t("p",[e._v("Before you run the playbook to install Prometheus and Grafana on Kubernetes, you need to ensure that you have already downloaded and installed "),t("code",[e._v("kubectl")]),e._v(" and set up your client bundle. Two convenience playbooks have been provided to make this process easier.")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/install-kubectl.yml")]),e._v(" installs a specific version of "),t("code",[e._v("kubectl")]),e._v(" based on the settings\nin your "),t("code",[e._v("group_vars/all/vars")]),e._v(" file.")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/kube-prometheus.yml")]),e._v(" is used to deploy the Prometheus/Grafana stack on Kubernetes.\nIt is a wrapper for a number of separate playbooks outlined below.")]),t("ul",[t("li",[t("code",[e._v("playbooks/kube-prometheus/operator.yml")])]),t("li",[t("code",[e._v("playbooks/kube-prometheus/kube-state-metrics.yml")])]),t("li",[t("code",[e._v("playbooks/kube-prometheus/node-exporter.yml")])]),t("li",[t("code",[e._v("playbooks/kube-prometheus/monitors.yml")])]),t("li",[t("code",[e._v("playbooks/kube-prometheus/prometheus.yml")])]),t("li",[t("code",[e._v("playbooks/kube-prometheus/grafana.yml")])])]),t("p",[e._v("You can choose not to install certain components by commenting out the appropriate line in the wrapper playbook.")]),t("h2",{attrs:{id:"prometheus-operator"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-operator","aria-hidden":"true"}},[e._v("#")]),e._v(" Prometheus Operator")]),t("p",[e._v("The Prometheus Operator makes running Prometheus on top of Kubernetes as easy as possible, while preserving Kubernetes-native configuration options. For more information on Prometheus Operator, see https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html.")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/kube-prometheus/operator.yml")]),e._v(" installs the operator itself.")]),t("h2",{attrs:{id:"kube-state-metrics"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kube-state-metrics","aria-hidden":"true"}},[e._v("#")]),e._v(" Kube state metrics")]),t("p",[t("code",[e._v("kube-state-metrics")]),e._v(" is a simple service that listens to the Kubernetes API server and generates metrics about the state of the objects. It is not focused on the health of the individual Kubernetes components, but rather on the health of the various objects inside, such as deployments, nodes and pods. For more information on "),t("code",[e._v("kube-state-metrics")]),e._v(", see https://github.com/kubernetes/kube-state-metrics.")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/kube-prometheus/kube-state-metrics.yml")]),e._v(" installs "),t("code",[e._v("kube-state-metrics")]),e._v(" on all UCP, DTR and Kubernetes worker nodes.")]),t("h2",{attrs:{id:"node-exporter"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter","aria-hidden":"true"}},[e._v("#")]),e._v(" Node exporter")]),t("p",[e._v("The "),t("code",[e._v("node-exporter")]),e._v(" provides an overview of cluster node resources including CPU, memory and disk utilization and more. For more information on "),t("code",[e._v("node-exporter")]),e._v(", see https://github.com/prometheus/node_exporter.")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/kube-prometheus/node-exporter.yml")]),e._v(" installs "),t("code",[e._v("node-exporter")]),e._v(" as a set of Docker containers on all UCP, DTR and Kubernetes worker nodes. Port "),t("code",[e._v("9100")]),e._v(" is opened in the firewall on each node where it is installed.")]),t("h2",{attrs:{id:"monitors"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#monitors","aria-hidden":"true"}},[e._v("#")]),e._v(" Monitors")]),t("p",[e._v("While all the other Kubernetes components run on top of Kubernetes itself, "),t("code",[e._v("kubelet")]),e._v(" and "),t("code",[e._v("apiserver")]),e._v(" do not, and so they just need service monitors to access these metrics.")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/kube-prometheus/monitors.yml")]),e._v(" installs Service Monitors for "),t("code",[e._v("kubelet")]),e._v(" and "),t("code",[e._v("apiserver")]),e._v(".")]),t("h2",{attrs:{id:"cadvisor"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cadvisor","aria-hidden":"true"}},[e._v("#")]),e._v(" cAdvisor")]),t("p",[e._v("Support for cAdvisor is built-in to Kubernetes, so cAdvisor metrics will automatically be available within Prometheus, without any other configuration required.")]),t("p",[t("strong",[e._v("Note:")]),e._v("\nBecause Docker EE provides a hosted version of Kubernetes, it is not possible to access metrics for "),t("code",[e._v("kube-scheduler")]),e._v(" and "),t("code",[e._v("kube-controller-manager")]),e._v(".")]),t("h2",{attrs:{id:"prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus","aria-hidden":"true"}},[e._v("#")]),e._v(" Prometheus")]),t("p",[e._v("For convenience, the playbook sets up a NodePort so that the Prometheus UI can be accessed on port "),t("code",[e._v("33090")]),e._v(", as shown in the following code extract:")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# kubectl -n monitoring patch svc prometheus-k8s --type=\'json\' -p \'[{"op":"replace","path":"/spec/type","value":"NodePort"}]\'\n\n# kubectl -n monitoring patch svc prometheus-k8s --type=\'json\' -p \'[{"op": "add", "path":"/spec/ports/0/nodePort", "value":33090}]\'\n')])]),t("p",[e._v("On a production system, it is likely that you will want to remove this NodePort. The following code segment\nshows how you can use the "),t("code",[e._v("patch")]),e._v(" command to remove the NodePort.")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# kubectl -n monitoring patch svc prometheus-k8s --type=\'json\' -p \'[{"op": "remove", "path":"/spec/ports/0/nodePort"}]\'\n\n# kubectl -n monitoring patch svc prometheus-k8s --type=\'json\' -p \'[{"op": "remove", "path":"/spec/type"}]\'\n')])]),t("h2",{attrs:{id:"grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grafana","aria-hidden":"true"}},[e._v("#")]),e._v(" Grafana")]),t("p",[e._v("For convenience, the playbook sets up a NodePort so that the Grafana UI can be access on the port "),t("code",[e._v("33030")]),e._v(", as shown in the following code extract:")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# kubectl -n monitoring patch svc grafana --type=\'json\' -p \'[{"op":"replace","path":"/spec/type", "value":"NodePort"}]\'\n\n# kubectl -n monitoring patch svc grafana --type=\'json\' -p \'[{"op": "add", "path":"/spec/ports/0/nodePort", "value":33030}]\'\n')])]),t("p",[e._v("On a production system, it is likely that you will want to remove this NodePort. The following code segment shows how you can use the "),t("code",[e._v("patch")]),e._v(" command to remove the NodePort.")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# kubectl -n monitoring patch svc grafana --type=\'json\' -p \'[{"op": "remove", "path":"/spec/ports/0/nodePort"}]\'\n\n# kubectl -n monitoring patch svc grafana --type=\'json\' -p \'[{"op": "remove", "path":"/spec/type"}]\'\n')])]),t("h2",{attrs:{id:"teardown"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#teardown","aria-hidden":"true"}},[e._v("#")]),e._v(" Teardown")]),t("p",[e._v("The playbook "),t("code",[e._v("playbooks/kube-prometheus-teardown.yml")]),e._v(" removes the installed Prometheus\\Grafana stack.")])])}],!1,null,null,null);o.default=a.exports}}]);