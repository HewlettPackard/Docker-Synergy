(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{114:function(e,t,r){"use strict";r.r(t);var a=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"using-hpe-3par-when-deploying-nfs-provisioner-for-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-hpe-3par-when-deploying-nfs-provisioner-for-kubernetes","aria-hidden":"true"}},[e._v("#")]),e._v(" Using HPE 3PAR when deploying NFS provisioner for Kubernetes")]),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[e._v("#")]),e._v(" Prerequisites")]),a("ul",[a("li",[e._v("Configure the variables described in the section "),a("code",[e._v("Kubernetes Persistent Volume configuration")])]),a("li",[e._v("Install the "),a("code",[e._v("kubectl")]),e._v(" binary on your Ansible box")]),a("li",[e._v("Install the UCP Client bundle for the "),a("code",[e._v("admin")]),e._v(" user")]),a("li",[e._v("Confirm that you can connect to the cluster by running a test command, for example, "),a("code",[e._v("kubectl get nodes")])])]),a("h2",{attrs:{id:"setting-up-hpe-3par"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-hpe-3par","aria-hidden":"true"}},[e._v("#")]),e._v(" Setting up HPE 3PAR")]),a("p",[e._v("The following section outlines the steps you need to follow in order to configure a Virtual File Server and a share for use by the Kubernetes NFS provisioner.")]),a("p",[e._v("Log in to the HPE 3PAR StoreServ Management console and perform the following tasks.")]),a("p",[a("strong",[e._v("Create a virtual file server (VFS):")])]),a("ol",[a("li",[a("p",[e._v("In the "),a("code",[e._v("General")]),e._v(" section, specify a name, in this instance "),a("code",[e._v("hpe_vfs3par")])]),a("p",[a("img",{attrs:{src:r(75),alt:'"Figure.  Create Virtual File Server - General"',title:"Figure. Create Virtual File Server - General"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create Virtual File Server - General")])]),a("li",[a("p",[e._v("In the Storage Allocation Settings section, set the Provisioning to Thin Provisioned, select an appropriate CPG, in this instance FC_r1, and set the size, for example, 1 terabyte.")]),a("p",[a("img",{attrs:{src:r(76),alt:'"Figure.  Create Virtual File Server - Storage Allocation Settings"',title:"Figure. Create Virtual File Server - Storage Allocation Settings"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create Virtual File Server - Storage Allocation Settings")])]),a("li",[a("p",[e._v("Add a virtual IP address")]),a("p",[a("img",{attrs:{src:r(77),alt:'"Figure.  Create Virtual File Server - Add Virtual IP Address"',title:"Figure. Create Virtual File Server - Add Virtual IP Address"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create Virtual File Server - Add Virtual IP Address")])])]),a("p",[e._v("These steps result in a Virtual File Server:")]),a("p",[a("img",{attrs:{src:r(78),alt:'"Figure.  Virtual File Server"',title:"Figure. Virtual File Server"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Virtual File Server")]),a("p",[a("strong",[e._v("Create a File Store:")])]),a("ol",[a("li",[a("p",[e._v("In the General section, specify a name, in this instance "),a("code",[e._v("HPE_filestore3par")]),e._v(", and select the Virtual File Server that you just created.")]),a("p",[a("img",{attrs:{src:r(79),alt:'"Figure.  Create File Store - General"',title:"Figure. Create File Store - General"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Store - General")])]),a("li",[a("p",[e._v("Use the default Security settings:\n"),a("img",{attrs:{src:r(80),alt:'"Figure.  Create File Store - Security"',title:"Figure. Create File Store - Security"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Store - Security")])])]),a("p",[e._v("These steps result in the File Store shown below:")]),a("p",[a("img",{attrs:{src:r(81),alt:'"Figure.  File Store"',title:"Figure. File Store"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  File Store")]),a("p",[a("strong",[e._v("Create a File Share:")])]),a("ol",[a("li",[a("p",[e._v("In the General section of the Create File Share dialog, set the share type to NFS Share and set a share name, for example, "),a("code",[e._v("hpe_fileshare3par")]),e._v(".")]),a("p",[a("img",{attrs:{src:r(82),alt:'"Figure.  Create File Share - General"',title:"Figure. Create File Share - General"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Share - General")])]),a("li",[a("p",[e._v("In the Share Path section, select the virtual file server and file store that you created earlier and set the sub-directory to "),a("code",[e._v("k8s")]),e._v(".")]),a("p",[a("img",{attrs:{src:r(83),alt:'"Figure.  Create File Share - Share Path"',title:"Figure. Create File Share - Share Path"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Share - Share Path")])]),a("li",[a("p",[e._v("In the Additional Settings section, set the Permission to Read/Write allowed and the Privilege to root squashing is off (no root squash):")]),a("p",[a("img",{attrs:{src:r(84),alt:'"Figure.  Create File Share - Additional Settings"',title:"Figure. Create File Share - Additional Settings"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Share - Additional Settings")])])]),a("p",[e._v("The overview for the created File Share is shown below and contains the information you need to specify the configuration variables.")]),a("p",[a("img",{attrs:{src:r(85),alt:'"Figure.  File Share"',title:"Figure. File Share"}})]),a("p",[a("strong",[e._v("Figure.")]),e._v("  File Share")]),a("h2",{attrs:{id:"configurating-nfs-on-hpe-3par-for-post-deployment-verification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configurating-nfs-on-hpe-3par-for-post-deployment-verification","aria-hidden":"true"}},[e._v("#")]),e._v(" Configurating NFS on HPE 3PAR for post-deployment verification")]),a("p",[e._v("In this example, it is assumed that the relevant variables are configured as follows:")]),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[e._v("Variable")]),a("th",{staticStyle:{"text-align":"left"}},[e._v("Value")])])]),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_namespace")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfsstorage")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_role")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfs-provisioner-runner-3par")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_serviceaccount")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfs-provisioner")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_name")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("hpe.com/nfs-3par")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_storage_class_name")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfs-3par")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_external_server")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("hpe_vfs3par.cloudra.local")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_server_share")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("/hpe_vfs3par/hpe_vfs3par/hpe_filestore3par/k8s")])])]),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_mount_options")]),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("'rw,sync,actimeo=0'")])])])])]),a("h2",{attrs:{id:"running-the-playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-the-playbook","aria-hidden":"true"}},[e._v("#")]),e._v(" Running the playbook")]),a("p",[e._v("Once the appropriate configuration has been establised, run the playbook:")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# cd ~/Docker-Synergy\n# ansible-playbook -i hosts playbooks/nfs-provisioner.yml --vault-password-file .vault_pass\n")])]),a("p",[e._v("Running the command "),a("code",[e._v("kubectl get sc")]),e._v(" will show the storage class named "),a("code",[e._v("nfs-3par")]),e._v(":")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# kubectl get sc\n\nNAME       PROVISIONER        AGE\nnfs-3par   hpe.com/nfs-3par   5m\n\n")])]),a("p",[e._v("The playbook has a built-in test to validate the provisioining. A pod is deployed to write some test content:")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('templates/nfs-provisioner/nfs-provisioner-writer-pod.yml.j2\n\nkind: Pod\napiVersion: v1\nmetadata:\n  name: writer-pod\nspec:\n  containers:\n  - name: writer-pod\n    image: gcr.io/google_containers/busybox:1.24\n    command:\n      - "/bin/sh"\n    args:\n      - "-c"\n      - "echo \'{{ TestMessage }}\' >/mnt/bar.txt && while [ 1 ] ; do sleep 2 ; done "\n    volumeMounts:\n      - name: nfs-pvc\n        mountPath: "/mnt"\n  restartPolicy: "Never"\n  volumes:\n    - name: nfs-pvc\n      persistentVolumeClaim:\n        claimName: test-claim\n')])]),a("p",[e._v("This pod is then deleted, and a new pod is deployed to check that the test content has been persisted after the\nwriter pod went away.")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('templates/nfs-provisioner/nfs-provisioner-reader-pod.yml.j2\n\nkind: Pod\napiVersion: v1\nmetadata:\n  name: reader-pod\nspec:\n  containers:\n  - name: reader-pod\n    image: gcr.io/google_containers/busybox:1.24\n    command:\n      - "/bin/sh"\n    args:\n      - "-c"\n      - "cat /mnt/bar.txt  && while [ 1 ] ; do sleep 1 ; done "\n    volumeMounts:\n      - name: nfs-pvc\n        mountPath: "/mnt"\n  restartPolicy: "Never"\n  volumes:\n    - name: nfs-pvc\n      persistentVolumeClaim:\n        claimName: test-claim\n')])]),a("p",[e._v("You should see the following output if the provisioning succeeds:")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('ok: [localhost] => {\n    "msg": "Successfully tested NFS persistent storage"\n}\n')])])])}],i=r(0),n=Object(i.a)({},function(){this.$createElement;this._self._c;return this._m(0)},a,!1,null,null,null);t.default=n.exports},75:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs.9d609fb8.png"},76:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs-storage.ba6f9ac5.png"},77:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs-vip.ae8c5500.png"},78:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs-complete.cd8f5d0d.png"},79:function(e,t,r){e.exports=r.p+"assets/img/3par-create-filestore.4ae070a4.png"},80:function(e,t,r){e.exports=r.p+"assets/img/3par-create-filestore-security.cf2aa5a8.png"},81:function(e,t,r){e.exports=r.p+"assets/img/3par-create-filestore-complete.24cbbad5.png"},82:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare.ab95ce6a.png"},83:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare-sharepath-k8s.0a0c7f3c.png"},84:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare-additional.f72ef2a4.png"},85:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare-complete-k8s.b5d006b7.png"}}]);