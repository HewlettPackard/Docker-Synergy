(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{212:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs.9d609fb8.png"},213:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs-storage.ba6f9ac5.png"},214:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs-vip.ae8c5500.png"},215:function(e,t,r){e.exports=r.p+"assets/img/3par-create-vfs-complete.cd8f5d0d.png"},216:function(e,t,r){e.exports=r.p+"assets/img/3par-create-filestore.4ae070a4.png"},217:function(e,t,r){e.exports=r.p+"assets/img/3par-create-filestore-security.cf2aa5a8.png"},218:function(e,t,r){e.exports=r.p+"assets/img/3par-create-filestore-complete.24cbbad5.png"},219:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare.ab95ce6a.png"},220:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare-sharepath-k8s.0a0c7f3c.png"},221:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare-additional.f72ef2a4.png"},222:function(e,t,r){e.exports=r.p+"assets/img/3par-create-fileshare-complete-k8s.b5d006b7.png"},245:function(e,t,r){"use strict";r.r(t);var a=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"using-hpe-3par-when-deploying-nfs-provisioner-for-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-hpe-3par-when-deploying-nfs-provisioner-for-kubernetes","aria-hidden":"true"}},[e._v("#")]),e._v(" Using HPE 3PAR when deploying NFS provisioner for Kubernetes")]),e._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[e._v("Configure the variables described in the section "),a("code",[e._v("Kubernetes Persistent Volume configuration")])]),e._v(" "),a("li",[e._v("Install the "),a("code",[e._v("kubectl")]),e._v(" binary on your Ansible box")]),e._v(" "),a("li",[e._v("Install the UCP Client bundle for the "),a("code",[e._v("admin")]),e._v(" user")]),e._v(" "),a("li",[e._v("Confirm that you can connect to the cluster by running a test command, for example, "),a("code",[e._v("kubectl get nodes")])])]),e._v(" "),a("h2",{attrs:{id:"setting-up-hpe-3par"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-hpe-3par","aria-hidden":"true"}},[e._v("#")]),e._v(" Setting up HPE 3PAR")]),e._v(" "),a("p",[e._v("The following section outlines the steps you need to follow in order to configure a Virtual File Server and a share for use by the Kubernetes NFS provisioner.")]),e._v(" "),a("p",[e._v("Log in to the HPE 3PAR StoreServ Management console and perform the following tasks.")]),e._v(" "),a("p",[a("strong",[e._v("Create a virtual file server (VFS):")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("In the "),a("code",[e._v("General")]),e._v(" section, specify a name, in this instance "),a("code",[e._v("hpe_vfs3par")])]),e._v(" "),a("p",[a("img",{attrs:{src:r(212),alt:'"Figure.  Create Virtual File Server - General"',title:"Figure. Create Virtual File Server - General"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create Virtual File Server - General")])]),e._v(" "),a("li",[a("p",[e._v("In the Storage Allocation Settings section, set the Provisioning to Thin Provisioned, select an appropriate CPG, in this instance FC_r1, and set the size, for example, 1 terabyte.")]),e._v(" "),a("p",[a("img",{attrs:{src:r(213),alt:'"Figure.  Create Virtual File Server - Storage Allocation Settings"',title:"Figure. Create Virtual File Server - Storage Allocation Settings"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create Virtual File Server - Storage Allocation Settings")])]),e._v(" "),a("li",[a("p",[e._v("Add a virtual IP address")]),e._v(" "),a("p",[a("img",{attrs:{src:r(214),alt:'"Figure.  Create Virtual File Server - Add Virtual IP Address"',title:"Figure. Create Virtual File Server - Add Virtual IP Address"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create Virtual File Server - Add Virtual IP Address")])])]),e._v(" "),a("p",[e._v("These steps result in a Virtual File Server:")]),e._v(" "),a("p",[a("img",{attrs:{src:r(215),alt:'"Figure.  Virtual File Server"',title:"Figure. Virtual File Server"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Virtual File Server")]),e._v(" "),a("p",[a("strong",[e._v("Create a File Store:")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("In the General section, specify a name, in this instance "),a("code",[e._v("HPE_filestore3par")]),e._v(", and select the Virtual File Server that you just created.")]),e._v(" "),a("p",[a("img",{attrs:{src:r(216),alt:'"Figure.  Create File Store - General"',title:"Figure. Create File Store - General"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Store - General")])]),e._v(" "),a("li",[a("p",[e._v("Use the default Security settings:\n"),a("img",{attrs:{src:r(217),alt:'"Figure.  Create File Store - Security"',title:"Figure. Create File Store - Security"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Store - Security")])])]),e._v(" "),a("p",[e._v("These steps result in the File Store shown below:")]),e._v(" "),a("p",[a("img",{attrs:{src:r(218),alt:'"Figure.  File Store"',title:"Figure. File Store"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  File Store")]),e._v(" "),a("p",[a("strong",[e._v("Create a File Share:")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("In the General section of the Create File Share dialog, set the share type to NFS Share and set a share name, for example, "),a("code",[e._v("hpe_fileshare3par")]),e._v(".")]),e._v(" "),a("p",[a("img",{attrs:{src:r(219),alt:'"Figure.  Create File Share - General"',title:"Figure. Create File Share - General"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Share - General")])]),e._v(" "),a("li",[a("p",[e._v("In the Share Path section, select the virtual file server and file store that you created earlier and set the sub-directory to "),a("code",[e._v("k8s")]),e._v(".")]),e._v(" "),a("p",[a("img",{attrs:{src:r(220),alt:'"Figure.  Create File Share - Share Path"',title:"Figure. Create File Share - Share Path"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Share - Share Path")])]),e._v(" "),a("li",[a("p",[e._v("In the Additional Settings section, set the Permission to Read/Write allowed and the Privilege to root squashing is off (no root squash):")]),e._v(" "),a("p",[a("img",{attrs:{src:r(221),alt:'"Figure.  Create File Share - Additional Settings"',title:"Figure. Create File Share - Additional Settings"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  Create File Share - Additional Settings")])])]),e._v(" "),a("p",[e._v("The overview for the created File Share is shown below and contains the information you need to specify the configuration variables.")]),e._v(" "),a("p",[a("img",{attrs:{src:r(222),alt:'"Figure.  File Share"',title:"Figure. File Share"}})]),e._v(" "),a("p",[a("strong",[e._v("Figure.")]),e._v("  File Share")]),e._v(" "),a("h2",{attrs:{id:"configurating-nfs-on-hpe-3par-for-post-deployment-verification"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configurating-nfs-on-hpe-3par-for-post-deployment-verification","aria-hidden":"true"}},[e._v("#")]),e._v(" Configurating NFS on HPE 3PAR for post-deployment verification")]),e._v(" "),a("p",[e._v("In this example, it is assumed that the relevant variables are configured as follows:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[e._v("Variable")]),e._v(" "),a("th",{staticStyle:{"text-align":"left"}},[e._v("Value")])])]),e._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_namespace")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfsstorage")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_role")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfs-provisioner-runner-3par")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_serviceaccount")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfs-provisioner")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_name")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("hpe.com/nfs-3par")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_storage_class_name")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("nfs-3par")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_external_server")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("hpe_vfs3par.cloudra.local")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_provisioner_server_share")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("/hpe_vfs3par/hpe_vfs3par/hpe_filestore3par/k8s")])])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[e._v("nfs_mount_options")]),e._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[e._v("'rw,sync,actimeo=0'")])])])])]),e._v(" "),a("h2",{attrs:{id:"running-the-playbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-the-playbook","aria-hidden":"true"}},[e._v("#")]),e._v(" Running the playbook")]),e._v(" "),a("p",[e._v("Once the appropriate configuration has been establised, run the playbook:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# cd ~/Docker-Synergy\n# ansible-playbook -i hosts playbooks/nfs-provisioner.yml --vault-password-file .vault_pass\n")])])]),a("p",[e._v("Running the command "),a("code",[e._v("kubectl get sc")]),e._v(" will show the storage class named "),a("code",[e._v("nfs-3par")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# kubectl get sc\n\nNAME       PROVISIONER        AGE\nnfs-3par   hpe.com/nfs-3par   5m\n\n")])])]),a("p",[e._v("The playbook has a built-in test to validate the provisioining. A pod is deployed to write some test content:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('templates/nfs-provisioner/nfs-provisioner-writer-pod.yml.j2\n\nkind: Pod\napiVersion: v1\nmetadata:\n  name: writer-pod\nspec:\n  containers:\n  - name: writer-pod\n    image: gcr.io/google_containers/busybox:1.24\n    command:\n      - "/bin/sh"\n    args:\n      - "-c"\n      - "echo \'{{ TestMessage }}\' >/mnt/bar.txt && while [ 1 ] ; do sleep 2 ; done "\n    volumeMounts:\n      - name: nfs-pvc\n        mountPath: "/mnt"\n  restartPolicy: "Never"\n  volumes:\n    - name: nfs-pvc\n      persistentVolumeClaim:\n        claimName: test-claim\n')])])]),a("p",[e._v("This pod is then deleted, and a new pod is deployed to check that the test content has been persisted after the\nwriter pod went away.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('templates/nfs-provisioner/nfs-provisioner-reader-pod.yml.j2\n\nkind: Pod\napiVersion: v1\nmetadata:\n  name: reader-pod\nspec:\n  containers:\n  - name: reader-pod\n    image: gcr.io/google_containers/busybox:1.24\n    command:\n      - "/bin/sh"\n    args:\n      - "-c"\n      - "cat /mnt/bar.txt  && while [ 1 ] ; do sleep 1 ; done "\n    volumeMounts:\n      - name: nfs-pvc\n        mountPath: "/mnt"\n  restartPolicy: "Never"\n  volumes:\n    - name: nfs-pvc\n      persistentVolumeClaim:\n        claimName: test-claim\n')])])]),a("p",[e._v("You should see the following output if the provisioning succeeds:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('ok: [localhost] => {\n    "msg": "Successfully tested NFS persistent storage"\n}\n')])])])])}],i=r(0),s=Object(i.a)({},function(){this.$createElement;this._self._c;return this._m(0)},a,!1,null,null,null);t.default=s.exports}}]);