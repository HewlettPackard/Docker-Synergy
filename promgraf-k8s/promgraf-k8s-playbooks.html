<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HPE Enterprise Containers | Playbooks for installing Prometheus and Grafana on Kubernetes</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/Docker-Synergy/assets/css/styles.a57224f5.css" as="style"><link rel="preload" href="/Docker-Synergy/assets/js/app.a57224f5.js" as="script"><link rel="preload" href="/Docker-Synergy/assets/js/82.da1b792c.js" as="script"><link rel="prefetch" href="/Docker-Synergy/assets/js/1.cdb2fd8c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/10.32c2edb4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/100.08bbd64f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/101.fe44763b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/102.ea7ec860.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/103.298b6084.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/104.b85c502f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/105.5127d856.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/106.68c3327d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/107.3a7c9ce1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/108.233cf5e7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/11.167e0dfa.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/12.46c2fbef.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/13.3b2aea0f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/14.eeac5982.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/15.6f656db9.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/16.09101068.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/17.8ac3a12b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/18.79bc02e9.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/19.c550e18d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/2.dddf5cdb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/20.267dcfc2.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/21.2effdb0d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/22.0e7be733.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/23.2bf3cd42.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/24.802c0517.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/25.a279e4ff.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/26.e17d878d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/27.e4f2ab29.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/28.ac6491cd.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/29.97af9ea1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/3.40ffb3a6.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/30.616c068c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/31.69c5705d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/32.939f33e8.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/33.64f09a39.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/34.6ff8e25a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/35.3df17ded.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/36.77efbead.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/37.cbc70064.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/38.9a62de58.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/39.d66ab5ae.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/4.005f283c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/40.697525b4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/41.b3d2fe8d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/42.309c75c4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/43.1b668203.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/44.972ccfb0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/45.eb0e3355.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/46.c23b655a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/47.f5750192.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/48.cc5310ec.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/49.a64b81ea.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/5.e54f1458.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/50.e456b883.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/51.805d7e06.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/52.5be4589f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/53.9cb3071a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/54.2b3e96e5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/55.5bed16bd.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/56.0eda226c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/57.3c366d0c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/58.cdedbac4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/59.4011f139.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/6.3eabc255.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/60.00ade006.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/61.eaf2b08e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/62.9c053c24.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/63.f8dbb065.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/64.3297458f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/65.e123b724.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/66.e36f12ee.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/67.359fe534.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/68.96778a25.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/69.ed2998bf.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/7.85880128.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/70.2001859e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/71.7421db8b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/72.cb751baa.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/73.f4781509.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/74.f21f92d0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/75.d304a8f4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/76.10110819.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/77.d692816a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/78.559b9a20.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/79.c30e5297.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/8.61b6bcab.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/80.8f897b4f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/81.61081543.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/83.d9013025.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/84.92e895df.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/85.28af8e3d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/86.d9c6d066.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/87.5f164c7e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/88.47cd330d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/89.83ef885d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/9.b5c0b3b3.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/90.c110c44f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/91.c1fea79d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/92.d8541219.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/93.9691b2e7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/94.14069dd5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/95.036f5441.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/96.c4f68a14.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/97.8c856662.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/98.589ecef5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/99.4e566a89.js">
    <link rel="stylesheet" href="/Docker-Synergy/assets/css/styles.a57224f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/Docker-Synergy/" class="home-link router-link-active"><!----><span class="site-name">
      HPE Enterprise Containers
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div><a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div><a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Introduction</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Release notes</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preparing the environment</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring the core components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Overview of the playbooks</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying core components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Post deployment</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring Storage</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Windows VM workers</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying bare metal workers</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Sysdig monitoring</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Splunk</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Deploying Prometheus and Grafana on Kubernetes</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-overview.html" class="sidebar-link">Monitoring Kubernetes with Prometheus and Grafana</a></li><li><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html" class="active sidebar-link">Playbooks for installing Prometheus and Grafana on Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#prometheus-operator" class="sidebar-link">Prometheus Operator</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#kube-state-metrics" class="sidebar-link">Kube state metrics</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#node-exporter" class="sidebar-link">Node exporter</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#monitors" class="sidebar-link">Monitors</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#cadvisor" class="sidebar-link">cAdvisor</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#prometheus" class="sidebar-link">Prometheus</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#grafana" class="sidebar-link">Grafana</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-playbooks.html#teardown" class="sidebar-link">Teardown</a></li></ul></li><li><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-prometheus.html" class="sidebar-link">Prometheus UI</a></li><li><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-grafana.html" class="sidebar-link">Grafana UI</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Docker Swarm</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Backup and restore</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution lifecycle management</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Appendices</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="playbooks-for-installing-prometheus-and-grafana-on-kubernetes"><a href="#playbooks-for-installing-prometheus-and-grafana-on-kubernetes" aria-hidden="true" class="header-anchor">#</a> Playbooks for installing Prometheus and Grafana on Kubernetes</h1><h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2><p>Before you run the playbook to install Prometheus and Grafana on Kubernetes, you need to ensure that you have already downloaded and installed <code>kubectl</code> and set up your client bundle. Two convenience playbooks have been provided to make this process easier.</p><p>The playbook <code>playbooks/install-kubectl.yml</code> installs a specific version of <code>kubectl</code> based on the settings
in your <code>group_vars/all/vars</code> file.</p><p>The playbook <code>playbooks/kube-prometheus.yml</code> is used to deploy the Prometheus/Grafana stack on Kubernetes.
It is a wrapper for a number of separate playbooks outlined below.</p><ul><li><code>playbooks/kube-prometheus/operator.yml</code></li><li><code>playbooks/kube-prometheus/kube-state-metrics.yml</code></li><li><code>playbooks/kube-prometheus/node-exporter.yml</code></li><li><code>playbooks/kube-prometheus/monitors.yml</code></li><li><code>playbooks/kube-prometheus/prometheus.yml</code></li><li><code>playbooks/kube-prometheus/grafana.yml</code></li></ul><p>You can choose not to install certain components by commenting out the appropriate line in the wrapper playbook.</p><h2 id="prometheus-operator"><a href="#prometheus-operator" aria-hidden="true" class="header-anchor">#</a> Prometheus Operator</h2><p>The Prometheus Operator makes running Prometheus on top of Kubernetes as easy as possible, while preserving Kubernetes-native configuration options. For more information on Prometheus Operator, see https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html.</p><p>The playbook <code>playbooks/kube-prometheus/operator.yml</code> installs the operator itself.</p><h2 id="kube-state-metrics"><a href="#kube-state-metrics" aria-hidden="true" class="header-anchor">#</a> Kube state metrics</h2><p><code>kube-state-metrics</code> is a simple service that listens to the Kubernetes API server and generates metrics about the state of the objects. It is not focused on the health of the individual Kubernetes components, but rather on the health of the various objects inside, such as deployments, nodes and pods. For more information on <code>kube-state-metrics</code>, see https://github.com/kubernetes/kube-state-metrics.</p><p>The playbook <code>playbooks/kube-prometheus/kube-state-metrics.yml</code> installs <code>kube-state-metrics</code> on all UCP, DTR and Kubernetes worker nodes.</p><h2 id="node-exporter"><a href="#node-exporter" aria-hidden="true" class="header-anchor">#</a> Node exporter</h2><p>The <code>node-exporter</code> provides an overview of cluster node resources including CPU, memory and disk utilization and more. For more information on <code>node-exporter</code>, see https://github.com/prometheus/node_exporter.</p><p>The playbook <code>playbooks/kube-prometheus/node-exporter.yml</code> installs <code>node-exporter</code> as a set of Docker containers on all UCP, DTR and Kubernetes worker nodes. Port <code>9100</code> is opened in the firewall on each node where it is installed.</p><h2 id="monitors"><a href="#monitors" aria-hidden="true" class="header-anchor">#</a> Monitors</h2><p>While all the other Kubernetes components run on top of Kubernetes itself, <code>kubelet</code> and <code>apiserver</code> do not, and so they just need service monitors to access these metrics.</p><p>The playbook <code>playbooks/kube-prometheus/monitors.yml</code> installs Service Monitors for <code>kubelet</code> and <code>apiserver</code>.</p><h2 id="cadvisor"><a href="#cadvisor" aria-hidden="true" class="header-anchor">#</a> cAdvisor</h2><p>Support for cAdvisor is built-in to Kubernetes, so cAdvisor metrics will automatically be available within Prometheus, without any other configuration required.</p><p><strong>Note:</strong>
Because Docker EE provides a hosted version of Kubernetes, it is not possible to access metrics for <code>kube-scheduler</code> and <code>kube-controller-manager</code>.</p><h2 id="prometheus"><a href="#prometheus" aria-hidden="true" class="header-anchor">#</a> Prometheus</h2><p>For convenience, the playbook sets up a NodePort so that the Prometheus UI can be accessed on port <code>33090</code>, as shown in the following code extract:</p><pre class="language-text"><code># kubectl -n monitoring patch svc prometheus-k8s --type='json' -p '[{&quot;op&quot;:&quot;replace&quot;,&quot;path&quot;:&quot;/spec/type&quot;,&quot;value&quot;:&quot;NodePort&quot;}]'

# kubectl -n monitoring patch svc prometheus-k8s --type='json' -p '[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;:&quot;/spec/ports/0/nodePort&quot;, &quot;value&quot;:33090}]'
</code></pre><p>On a production system, it is likely that you will want to remove this NodePort. The following code segment
shows how you can use the <code>patch</code> command to remove the NodePort.</p><pre class="language-text"><code># kubectl -n monitoring patch svc prometheus-k8s --type='json' -p '[{&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;:&quot;/spec/ports/0/nodePort&quot;}]'

# kubectl -n monitoring patch svc prometheus-k8s --type='json' -p '[{&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;:&quot;/spec/type&quot;}]'
</code></pre><h2 id="grafana"><a href="#grafana" aria-hidden="true" class="header-anchor">#</a> Grafana</h2><p>For convenience, the playbook sets up a NodePort so that the Grafana UI can be access on the port <code>33030</code>, as shown in the following code extract:</p><pre class="language-text"><code># kubectl -n monitoring patch svc grafana --type='json' -p '[{&quot;op&quot;:&quot;replace&quot;,&quot;path&quot;:&quot;/spec/type&quot;, &quot;value&quot;:&quot;NodePort&quot;}]'

# kubectl -n monitoring patch svc grafana --type='json' -p '[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;:&quot;/spec/ports/0/nodePort&quot;, &quot;value&quot;:33030}]'
</code></pre><p>On a production system, it is likely that you will want to remove this NodePort. The following code segment shows how you can use the <code>patch</code> command to remove the NodePort.</p><pre class="language-text"><code># kubectl -n monitoring patch svc grafana --type='json' -p '[{&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;:&quot;/spec/ports/0/nodePort&quot;}]'

# kubectl -n monitoring patch svc grafana --type='json' -p '[{&quot;op&quot;: &quot;remove&quot;, &quot;path&quot;:&quot;/spec/type&quot;}]'
</code></pre><h2 id="teardown"><a href="#teardown" aria-hidden="true" class="header-anchor">#</a> Teardown</h2><p>The playbook <code>playbooks/kube-prometheus-teardown.yml</code> removes the installed Prometheus\Grafana stack.</p></div><div class="content edit-link"><a href="https://github.com/HewlettPackard/Docker-Synergy/edit/devel/docs-src/promgraf-k8s/promgraf-k8s-playbooks.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-overview.html" class="prev">
          Monitoring Kubernetes with Prometheus and Grafana
        </a></span><span class="next"><a href="/Docker-Synergy/promgraf-k8s/promgraf-k8s-prometheus.html">
          Prometheus UI
        </a> →
      </span></p></div></div></div></div>
    <script src="/Docker-Synergy/assets/js/app.a57224f5.js" defer></script><script src="/Docker-Synergy/assets/js/82.da1b792c.js" defer></script>
  </body>
</html>
