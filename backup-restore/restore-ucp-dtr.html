<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HPE Enterprise Containers | Restoring your cluster after a disaster</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/Docker-Synergy/assets/css/styles.ee35edd7.css" as="style"><link rel="preload" href="/Docker-Synergy/assets/js/app.ee35edd7.js" as="script"><link rel="preload" href="/Docker-Synergy/assets/js/31.33e9d24d.js" as="script"><link rel="prefetch" href="/Docker-Synergy/assets/js/1.a662ab65.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/10.4c39bd31.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/100.9d3cb3ad.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/101.81e80351.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/102.8ff87bc4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/103.4288d928.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/104.1669c1ef.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/105.8deecb28.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/106.374e7d8b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/107.77a72feb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/108.f1692157.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/109.2157b8bc.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/11.142bdd5e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/12.3d1bb336.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/13.eaf1f5e5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/14.67eeb52a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/15.e4ed7cbf.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/16.03b8c558.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/17.098005a1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/18.add49489.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/19.7f2463e0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/2.912071f3.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/20.f8e81d75.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/21.aad9ccee.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/22.d4ee645e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/23.96df0793.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/24.7686224b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/25.69ba7ead.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/26.565cf8a7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/27.c5be63e7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/28.c806398a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/29.2f0c780b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/3.6149c576.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/30.eacad12f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/32.5114e800.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/33.a56f58e4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/34.69c22b24.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/35.7d24a516.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/36.7024c48b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/37.86830470.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/38.ee4ad1bb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/39.fd6edc3e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/4.bfc6fbcc.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/40.74edb01b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/41.f54305c5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/42.4ad275c5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/43.6a0e46a5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/44.72bcc252.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/45.336c7970.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/46.8f792805.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/47.27bc75e5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/48.9d6aa0a0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/49.a1ec324b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/5.375b34aa.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/50.7fc22e38.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/51.3d21e3ea.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/52.bad378fc.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/53.e834cb39.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/54.8c4ff143.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/55.b8b3aaf5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/56.78d8c152.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/57.ac385698.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/58.aad9a945.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/59.e3b3276b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/6.29c1dc8f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/60.51804c36.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/61.4b2c334b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/62.635070da.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/63.d4315fdb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/64.372fe538.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/65.a4e0c96c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/66.5fb73d9e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/67.050ab3d1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/68.673c8830.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/69.995d23bf.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/7.4ec2e9eb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/70.c05b6e4b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/71.425ae41e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/72.6c491f7e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/73.8b6fd98b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/74.dad74952.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/75.ad9ac462.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/76.4a5a2098.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/77.e6b51805.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/78.35e850e7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/79.41fdca01.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/8.9cf28a27.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/80.f86e2e3a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/81.d9320f6a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/82.f06c6016.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/83.13318e32.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/84.18ee5824.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/85.4994a054.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/86.2c52be61.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/87.5993fe46.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/88.3e4b0be6.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/89.7a6acd88.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/9.7bba5a1f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/90.fc0dbb0d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/91.bdf72ea4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/92.dfd1068f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/93.ee44fdde.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/94.f0b0eaeb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/95.00be522d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/96.d2629d4c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/97.0ffeca6a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/98.338419ab.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/99.94dba671.js">
    <link rel="stylesheet" href="/Docker-Synergy/assets/css/styles.ee35edd7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/Docker-Synergy/" class="home-link router-link-active"><!----><span class="site-name">
      HPE Enterprise Containers
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div><a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div><a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Introduction</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Release notes</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preparing the environment</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring the core components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Overview of the playbooks</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying core components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Post deployment</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring Storage</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Windows VM workers</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying bare metal workers</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Sysdig monitoring</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Splunk</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Kubernetes</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Docker Swarm</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Backup and restore</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/Docker-Synergy/backup-restore/backup-restore.html" class="sidebar-link">Introduction to backup and restore</a></li><li><a href="/Docker-Synergy/backup-restore/backup-ucp-dtr.html" class="sidebar-link">Backup UCP and DTR</a></li><li><a href="/Docker-Synergy/backup-restore/restore-ucp-dtr.html" class="active sidebar-link">Restoring your cluster after a disaster</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docker-Synergy/backup-restore/restore-ucp-dtr.html#before-you-restore" class="sidebar-link">Before you restore</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/backup-restore/restore-ucp-dtr.html#restore-ucp-and-dtr" class="sidebar-link">Restore UCP and DTR</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/backup-restore/restore-ucp-dtr.html#restore-dtr-metadata-and-dtr-images" class="sidebar-link">Restore DTR metadata and DTR images</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/backup-restore/restore-ucp-dtr.html#related-playbooks" class="sidebar-link">Related playbooks</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution lifecycle management</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Appendices</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="restoring-your-cluster-after-a-disaster"><a href="#restoring-your-cluster-after-a-disaster" aria-hidden="true" class="header-anchor">#</a> Restoring your cluster after a disaster</h1><p>The playbooks address a disaster recovery scenario where you have lost your entire cluster and all the VMs. Other scenarios and how to handle them are described in the Docker documentation including the following scenarios:</p><ul><li>You have lost one UCP instance but your cluster still has the quorum. The easiest way is to recreate the missing UCP instance from scratch.</li><li>You have lost the quorum in your UCP cluster but there is still one UCP instance running.</li><li>You have lost one instance of DTR but still have a quorum of replicas. The easiest way is to recreate the missing DTR instance from scratch.</li><li>You have lost the quorum of your DTR cluster but still have one DTR instance running.</li></ul><h2 id="before-you-restore"><a href="#before-you-restore" aria-hidden="true" class="header-anchor">#</a> Before you restore</h2><p><strong>Step 1.</strong> Retrieve the backup files using your chosen backup solution and save them to a folder on your Ansible server. If you have used timestamps in the naming of your backup files, you can use them to determine the chronological order. If you used the <code>backup.sh</code> script specifying a date prefix, you can use that to identify the matching set of backup files. You should choose the files in the following reverse chronological order, from the most recent to the oldest file. Make sure you restore both the <code>*.tgz</code> and the <code>*.vars.tgz</code> files.</p><ol><li>DTR images backup</li><li>DTR metadata backup</li><li>UCP backup</li><li>Swarm backup</li></ol><p>In this example, we will assume a set of backup files stored in <code>/root/restore</code> that were created specifying a date prefix. These will have names like <code>2018_04_17_151734_swarm.tgz</code>, <code>2018_04_17_151734_ucp.tgz</code>, etc and the corresponding <code>.vars.tgz</code> files.</p><p><strong>Step 2:</strong> Retrieve the DTR replica ID, the DTR version and the UCP version</p><p>To retrieve the ID of the replica that was backed up, as well as the version of DTR, you need to extract the data from the <code>.vars.tgz</code> file associated with the archive of the DTR metadata. You can retrieve this as follows:</p><pre class="language-text"><code># tar -Oxf /root/restore/2018_04_17_151734_dtr_meta.vars.tgz meta.yml
backup_node=&quot;hpe-dtr01&quot;
replica_id=&quot;ad5204e8a4d0&quot;
backup_source=&quot;&quot;
ucp_version=&quot;&quot;
dtr_version=&quot;2.4.3&quot;

</code></pre><pre class="language-text"><code># tar -Oxf /root/restore/2018_04_17_151734_ucp.vars.tgz meta.yml
backup_node=&quot;hpe-ucp01&quot;
replica_id=&quot;&quot;
backup_source=&quot;&quot;
ucp_version=&quot;2.2.7&quot;
dtr_version=&quot;&quot;
</code></pre><p>Take note of the replica ID (<code>ad5204e8a4d0</code>), the version of DTR (<code>2.4.3</code>) and the version of UCP (<code>2.2.7</code>).</p><p><strong>Step 3:</strong> Populate the <code>group_vars/all/backups</code> file</p><pre class="language-text"><code>backup_swarm: &quot;/root/restore/2018_04_17_151734_swarm.tgz&quot;
backup_ucp: &quot;/root/restore/2018_04_17_151734_ucp.tgz&quot;
backup_dtr_meta: &quot;/root/restore/2018_04_17_151734_dtr_meta.tgz&quot;
backup_dtr_data: &quot;/root/restore/2018_04_17_151734_dtr_data.tgz&quot;
backup_dtr_id: &quot;ad5204e8a4d0&quot;
backup_dest: &quot;/root/backups&quot;
backup_server: &lt;IP of your ansible box&gt;
</code></pre><p>You should populate your <code>group_vars/all/backups</code> file as above, with the <code>backup_dtr_id</code> variable containing the value you retrieved in the preceding step as <code>replica_id=&quot;ad5204e8a4d0&quot;</code>.</p><p><strong>Step 4:</strong> Verify that your <code>group_vars/all/vars</code> file specifies the correct versions of DTR and UCP.</p><p>The playbooks use the versions of UCP and DTR as specified in your <code>group_vars/all/vars</code> file to restore your backups. You must ensure that the versions specified in your current <code>group_vars/all/vars</code> file correspond to the versions in the backups as determined above.</p><pre class="language-text"><code># cat group_vars/all/vars | grep dtr_version
dtr_version: '2.4.3'
</code></pre><pre class="language-text"><code>
# cat group_vars/all/vars | grep ucp_version
ucp_version: '2.2.7'
</code></pre><p><strong>Step 5:</strong> Restore UCP admin credentials if required</p><p>You must ensure that the UCP admin credentials in your current <code>group_vars/all/vars</code> file are those that were in effect when you generated the backup files. If they have changed since then, you must restore the original credentials for the duration of the restore procedure.</p><p><strong>Step 6:</strong> Restore your inventory (<code>hosts</code>)</p><p>Your inventory must reflect the environment that was present when the backup files were created. You can find a copy of the inventory as it was when the backup was taken in the <code>*.vars.tgz</code> files.</p><h2 id="restore-ucp-and-dtr"><a href="#restore-ucp-and-dtr" aria-hidden="true" class="header-anchor">#</a> Restore UCP and DTR</h2><p><strong>Warning:</strong> This procedure is aimed at restoring a cluster after a disaster. It assumes you have lost all the VMs in your cluster and want to redeploy using data that you backed up earlier. The solution follows Docker best practice, which means the swarm artifacts are not restored. You will need to restore your Docker volumes and your applications (stacks and services) when this procedure is complete.</p><ol><li><p>Ensure that you have completed all the preliminary steps as outlined in the section <a href="#">Before you restore</a></p></li><li><p>Run the restore playbook</p><pre class="language-text"><code>ansible-playbook -i hosts restore.yml
</code></pre><p>You may need to modify <code>restore.yml</code> before you run it, depending on what optional components you have deployed. For example, if you have not deployed Splunk, you will need to comment out the line:</p><pre class="language-text"><code>- import_playbook: playbooks/splunk_uf.yml
</code></pre><p>If not, you will get an error saying that Splunk components could not be restored when you run the playbook.</p></li><li><p>If you are using the image scanning functionality in DTR, you will need to re-download the vulnerability database. For more information, see the Docker documentation <a href="https://docs.docker.com/datacenter/dtr/2.5/guides/admin/configure/set-up-vulnerability-scans/#get-the-security-scanning-license" target="_blank" rel="noopener noreferrer">here</a>.</p></li></ol><p>You are now ready to restore your Docker volumes and your applications.</p><h2 id="restore-dtr-metadata-and-dtr-images"><a href="#restore-dtr-metadata-and-dtr-images" aria-hidden="true" class="header-anchor">#</a> Restore DTR metadata and DTR images</h2><p><strong>Note:</strong> This procedure restores DTR metadata and images and assumes you have lost all the DTR VMs in your cluster. It will redeploy using the DTR data that you backed up earlier and will also restore the images if the folder exported by the NFS VM is empty.</p><ol><li><p>Ensure that you have completed all the preliminary steps as outlined in the section <a href="#">Before you restore</a>. In this scenario, you need the archives for the DTR metadata and the DTR images.</p></li><li><p>Ensure that all the DTR VMs listed in your inventory are destroyed, using the vSphere Web Client to delete them if required. If you want to restore the DTR images you should also delete the NFS VM.</p></li><li><p>Remove the DTR nodes from the swarm by running the <code>docker node rm &lt;DTR node&gt;</code> command on a UCP node for each DTR node in your cluster. The following example shows the sequence of commands to use to remove the DTR nodes:</p><pre class="language-text"><code># docker node ls
ID         HOSTNAME                     STATUS              AVAILABILITY
aiz... *   hpe-ucp02.cloudra.local      Ready               Active
gvf...     hpe-dtr01.cloudra.local      Down                Active
ir4...     hpe-ucp03.cloudra.local      Ready               Active
mwf...     hpe-dtr02.cloudra.local      Down                Active
oqy...     hpe-ucp01.cloudra.local      Ready               Active
xqe...     hpe-worker01.cloudra.local   Ready               Active
zdu...     hpe-dtr03.cloudra.local      Down                Active

</code></pre><pre class="language-text"><code># docker node rm hpe-dtr01.cloudra.local
hpe-dtr01.cloudra.local
# docker node rm hpe-dtr02.cloudra.local
hpe-dtr02.cloudra.local
# docker node rm hpe-dtr03.cloudra.local
hpe-dtr03.cloudra.local

</code></pre><pre class="language-text"><code># docker node ls
ID         HOSTNAME                     STATUS              AVAILABILITY        
aiz...     hpe-ucp02.cloudra.local      Ready               Active     
ir4...     hpe-ucp03.cloudra.local      Ready               Active    
oqy... *   hpe-ucp01.cloudra.local      Ready               Active    
xqe...     hpe-worker01.cloudra.local   Ready               Active
</code></pre></li><li><p>Run the restore script:</p><pre class="language-text"><code>./restore_dtr.sh
</code></pre></li><li><p>If you are using the image scanning functionality in DTR, you will need to re-download the vulnerability database. For more information, see the Docker documentation <a href="https://docs.docker.com/datacenter/dtr/2.5/guides/admin/configure/set-up-vulnerability-scans/#get-the-security-scanning-license" target="_blank" rel="noopener noreferrer">here</a>.</p></li></ol><h2 id="related-playbooks"><a href="#related-playbooks" aria-hidden="true" class="header-anchor">#</a> Related playbooks</h2><ul><li><code>playbooks/restore_swarm.yml</code> is used to restore the swarm data</li><li><code>playbooks/restore_dtr_meta.yml</code> is used to restore DTR metadata</li><li><code>playbooks/restore_dtr_images.yml</code> is used to restore DTR images</li></ul></div><div class="content edit-link"><a href="https://github.com/HewlettPackard/Docker-Synergy/edit/devel/docs-src/backup-restore/restore-ucp-dtr.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/Docker-Synergy/backup-restore/backup-ucp-dtr.html" class="prev">
          Backup UCP and DTR
        </a></span><span class="next"><a href="/Docker-Synergy/lifecycle/lifecycle.html">
          Introduction to solution lifecycle management
        </a> →
      </span></p></div></div></div></div>
    <script src="/Docker-Synergy/assets/js/app.ee35edd7.js" defer></script><script src="/Docker-Synergy/assets/js/31.33e9d24d.js" defer></script>
  </body>
</html>
