<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HPE Enterprise Containers | Validating the NFS provisioner using WordPress and MySQL</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/Docker-Synergy/assets/css/styles.a57224f5.css" as="style"><link rel="preload" href="/Docker-Synergy/assets/js/app.a57224f5.js" as="script"><link rel="preload" href="/Docker-Synergy/assets/js/1.cdb2fd8c.js" as="script"><link rel="prefetch" href="/Docker-Synergy/assets/js/10.32c2edb4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/100.08bbd64f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/101.fe44763b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/102.ea7ec860.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/103.298b6084.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/104.b85c502f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/105.5127d856.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/106.68c3327d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/107.3a7c9ce1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/108.233cf5e7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/11.167e0dfa.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/12.46c2fbef.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/13.3b2aea0f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/14.eeac5982.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/15.6f656db9.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/16.09101068.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/17.8ac3a12b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/18.79bc02e9.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/19.c550e18d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/2.dddf5cdb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/20.267dcfc2.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/21.2effdb0d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/22.0e7be733.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/23.2bf3cd42.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/24.802c0517.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/25.a279e4ff.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/26.e17d878d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/27.e4f2ab29.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/28.ac6491cd.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/29.97af9ea1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/3.40ffb3a6.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/30.616c068c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/31.69c5705d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/32.939f33e8.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/33.64f09a39.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/34.6ff8e25a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/35.3df17ded.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/36.77efbead.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/37.cbc70064.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/38.9a62de58.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/39.d66ab5ae.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/4.005f283c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/40.697525b4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/41.b3d2fe8d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/42.309c75c4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/43.1b668203.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/44.972ccfb0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/45.eb0e3355.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/46.c23b655a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/47.f5750192.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/48.cc5310ec.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/49.a64b81ea.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/5.e54f1458.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/50.e456b883.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/51.805d7e06.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/52.5be4589f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/53.9cb3071a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/54.2b3e96e5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/55.5bed16bd.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/56.0eda226c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/57.3c366d0c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/58.cdedbac4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/59.4011f139.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/6.3eabc255.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/60.00ade006.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/61.eaf2b08e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/62.9c053c24.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/63.f8dbb065.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/64.3297458f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/65.e123b724.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/66.e36f12ee.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/67.359fe534.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/68.96778a25.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/69.ed2998bf.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/7.85880128.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/70.2001859e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/71.7421db8b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/72.cb751baa.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/73.f4781509.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/74.f21f92d0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/75.d304a8f4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/76.10110819.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/77.d692816a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/78.559b9a20.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/79.c30e5297.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/8.61b6bcab.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/80.8f897b4f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/81.61081543.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/82.da1b792c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/83.d9013025.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/84.92e895df.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/85.28af8e3d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/86.d9c6d066.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/87.5f164c7e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/88.47cd330d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/89.83ef885d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/9.b5c0b3b3.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/90.c110c44f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/91.c1fea79d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/92.d8541219.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/93.9691b2e7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/94.14069dd5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/95.036f5441.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/96.c4f68a14.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/97.8c856662.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/98.589ecef5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/99.4e566a89.js">
    <link rel="stylesheet" href="/Docker-Synergy/assets/css/styles.a57224f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/Docker-Synergy/" class="home-link router-link-active"><!----><span class="site-name">
      HPE Enterprise Containers
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div><a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div><a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Introduction</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Release notes</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution overview</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preparing the environment</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring the core components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Overview of the playbooks</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying core components</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Post deployment</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Configuring Storage</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/Docker-Synergy/storage/nfs-provisioner.html" class="sidebar-link">Deploying the NFS provisioner for Kubernetes</a></li><li><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html" class="active sidebar-link">Validating the NFS provisioner using WordPress and MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html#running-the-playbook" class="sidebar-link">Running the playbook</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html#configuring-wordpress" class="sidebar-link">Configuring WordPress</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html#create-your-first-post" class="sidebar-link">Create your first post</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html#test-persistence-for-wordpress" class="sidebar-link">Test persistence for WordPress</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/storage/wordpress-mysql-nfs.html#test-persistence-in-mysql" class="sidebar-link">Test persistence in MySQL</a></li></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Windows VM workers</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying bare metal workers</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Sysdig monitoring</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Splunk</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Kubernetes</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Docker Swarm</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Backup and restore</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution lifecycle management</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Appendices</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="validating-the-nfs-provisioner-using-wordpress-and-mysql"><a href="#validating-the-nfs-provisioner-using-wordpress-and-mysql" aria-hidden="true" class="header-anchor">#</a> Validating the NFS provisioner using WordPress and MySQL</h1><p>A sample playbook has been provided to show how to use the NFS provioner for perstent storage for a WordPress and MySQL deployment.</p><h2 id="prerequisites"><a href="#prerequisites" aria-hidden="true" class="header-anchor">#</a> Prerequisites</h2><ul><li>Install the <code>kubectl</code> binary on your Ansible box</li><li>Install the UCP Client bundle for the <code>admin</code> user</li><li>Confirm that you can connect to the cluster by running a test command, for example, <code>kubectl get nodes</code></li><li>Deploy the NFS provisioner as outlined in the preceeding section. The article assumes that the NFS
configuration is the same as used in that section, namely:</li></ul><table><thead><tr><th style="text-align:left">Variable</th><th style="text-align:left">Value</th></tr></thead><tbody><tr><td style="text-align:left">nfs_provisioner_namespace</td><td style="text-align:left"><code>nfsstorage</code></td></tr><tr><td style="text-align:left">nfs_provisioner_role</td><td style="text-align:left"><code>nfs-provisioner-runner</code></td></tr><tr><td style="text-align:left">nfs_provisioner_serviceaccount</td><td style="text-align:left"><code>nfs-provisioner</code></td></tr><tr><td style="text-align:left">nfs_provisioner_name</td><td style="text-align:left"><code>hpe.com/nfs</code></td></tr><tr><td style="text-align:left">nfs_provisioner_storage_class_name</td><td style="text-align:left"><code>nfs</code></td></tr><tr><td style="text-align:left">nfs_provisioner_server_ip</td><td style="text-align:left"><code>hpe2-nfs.am2.cloudra.local</code></td></tr><tr><td style="text-align:left">nfs_provisioner_server_share</td><td style="text-align:left"><code>/k8s</code></td></tr></tbody></table><h2 id="running-the-playbook"><a href="#running-the-playbook" aria-hidden="true" class="header-anchor">#</a> Running the playbook</h2><p>The playbook <code>test/playbooks/wordpress-mysql-nfs.yml</code> creates Persistent Volume Claims for both <code>Wordpress</code> and <code>MySQL</code>, deploys both applications and makes the <code>WordPress</code> UI available via a NodePort.</p><pre class="language-text"><code># cd ~/Docker-Synergy
#  ansible-playbook -i hosts ./test/playbooks/wordpress-mysql-nfs.yml --vault-password-file .vault_pass
</code></pre><p>The output shows the components created along with the NodePort for the <code>wordpress</code> service.</p><pre class="language-text"><code>ok: [localhost] =&gt; {
    &quot;ps.stdout_lines&quot;: [
        &quot;Cluster \&quot;ucp_hpe2-ucp01.am2.cloudra.local:6443_admin\&quot; set.&quot;,
        &quot;User \&quot;ucp_hpe2-ucp01.am2.cloudra.local:6443_admin\&quot; set.&quot;,
        &quot;Context \&quot;ucp_hpe2-ucp01.am2.cloudra.local:6443_admin\&quot; modified.&quot;,
        &quot;namespace/wordpress-mysql created&quot;,
        &quot;secret/mysql-pass created&quot;,
        &quot;persistentvolumeclaim/mysql-pv-claim created&quot;,
        &quot;persistentvolumeclaim/wp-pv-claim created&quot;,
        &quot;deployment.apps/wordpress-mysql created&quot;,
        &quot;deployment.apps/wordpress created&quot;,
        &quot;service/wordpress-mysql created&quot;,
        &quot;service/wordpress created&quot;,
        &quot;NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE&quot;,
        &quot;wordpress         NodePort    10.96.216.103   &lt;none&gt;        80:33790/TCP   0s&quot;,
        &quot;wordpress-mysql   ClusterIP   None            &lt;none&gt;        3306/TCP       0s&quot;
    ]
</code></pre><p>Browse to the specified port on any node in your cluster.</p><pre class="language-text"><code>http://hpe2-ucp01.am2.cloudra.local:33790
</code></pre><h2 id="configuring-wordpress"><a href="#configuring-wordpress" aria-hidden="true" class="header-anchor">#</a> Configuring WordPress</h2><p>You need to configure the language and password before WordPress is ready to use.</p><p><img src="/Docker-Synergy/assets/img/wordpress-install-1.fffa4d0f.png" alt=""Configure WordPress language"" title="Figure. Configure WordPress language"></p><p><strong>Figure.</strong> Configure WordPress language</p><p>Add  a username, password and other configuration details.</p><p><img src="/Docker-Synergy/assets/img/wordpress-install-2.47f4aa03.png" alt=""Configure WordPress password"" title="Figure. Configure WordPress password"></p><p><strong>Figure.</strong> Configure WordPress password</p><p>Log in to WordPress, with the user name and password you have just set up.</p><p><img src="/Docker-Synergy/assets/img/wordpress-install-3.5f8fd141.png" alt=""Configure WordPress password"" title="Figure. WordPress login"></p><p><strong>Figure.</strong> WordPress login</p><p>The welcome page is presented.</p><p><img src="/Docker-Synergy/assets/img/wordpress-welcome.8a09d488.png" alt=""WordPress welcome"" title="Figure. WordPress welcome"></p><p><strong>Figure.</strong> WordPress welcome</p><h2 id="create-your-first-post"><a href="#create-your-first-post" aria-hidden="true" class="header-anchor">#</a> Create your first post</h2><p>Click on <code>Write your first blog post</code> and start creating some content. Add a blog title and then click <code>Add Media</code> to upload an image to the Media Library and then <code>Insert into post</code>. In this example, the image is a file named
<code>380 with OmniStack.jpg</code>.</p><p><img src="/Docker-Synergy/assets/img/wordpress-newpost.19d56696.png" alt=""Create your first WordPress blog post"" title="Figure. Create your first WordPress blog post"></p><p><strong>Figure.</strong> Create your first WordPress blog post</p><p>Click <code>Publish</code> and then <code>View post</code> to see your new blog post.</p><p><img src="/Docker-Synergy/assets/img/wordpress-firstpost.2fa0f1aa.png" alt=""View your first WordPress blog post"" title="Figure. View your first post"></p><p><strong>Figure.</strong> View your first post</p><h2 id="test-persistence-for-wordpress"><a href="#test-persistence-for-wordpress" aria-hidden="true" class="header-anchor">#</a> Test persistence for WordPress</h2><p>Find your WordPress Persistent Volume Claim (PVC)</p><pre class="language-text"><code># kubectl -n wordpress-mysql get pvc
NAME             STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
mysql-pv-claim   Bound     pvc-d48880e3-2d58-11e9-adb2-0242ac110003   1Gi        RWO            nfs            1h
wp-pv-claim      Bound     pvc-d4bc101f-2d58-11e9-adb2-0242ac110003   20Gi       RWO            nfs            1h
</code></pre><p>Connect to the NFS VM and browse the <code>/k8s</code> folder to find the volume for the WordPress claim <code>wp-pv-claim</code>.</p><pre class="language-text"><code># ssh hpe2-nfs ls /k8s
wordpress-mysql-mysql-pv-claim-pvc-d48880e3-2d58-11e9-adb2-0242ac110003
wordpress-mysql-wp-pv-claim-pvc-d4bc101f-2d58-11e9-adb2-0242ac110003
</code></pre><p>Locate the <code>wp-content</code> folder.</p><pre class="language-text"><code># ssh hpe2-nfs ls /k8s/wordpress-mysql-wp-pv-claim-pvc-d4bc101f-2d58-11e9-adb2-0242ac110003
index.php
license.txt
readme.html
wp-activate.php
wp-admin
wp-blog-header.php
wp-comments-post.php
wp-config.php
wp-config-sample.php
wp-content
wp-cron.php
wp-includes
wp-links-opml.php
wp-load.php
wp-login.php
wp-mail.php
wp-settings.php
wp-signup.php
wp-trackback.php
xmlrpc.php
</code></pre><p>Now find the image used in the blog post.</p><pre class="language-text"><code># ssh hpe2-nfs ls /k8s/wordpress-mysql-wp-pv-claim-pvc-d4bc101f-2d58-11e9-adb2-0242ac110003/wp-content/uploads/2019/02
380-with-OmniStack-100x100.jpg
380-with-OmniStack-150x150.jpg
380-with-OmniStack-300x150.jpg
380-with-OmniStack-768x384.jpg
380-with-OmniStack.jpg
</code></pre><p>Note that WordPress has created a number of variations of the original image, for different screen sizes.</p><p>Shutdown wordpress (leave MySQL running for now)</p><pre class="language-text"><code># kubectl -n wordpress-mysql delete -f /tmp/wordpress-mysql-nfs/wordpress-deployment.yml
deployment.apps &quot;wordpress&quot; deleted
</code></pre><p>Refresh the page in the browser to confirm that WordPress is indeed inaccessible.</p><p><img src="/Docker-Synergy/assets/img/wordpress-cant-connect.a76daedd.png" alt=""Cannot connect to WordPress"" title="Figure. Cannot connect to WordPress"></p><p><strong>Figure.</strong> Cannot connect to WordPress</p><p>Redeploy Wordpress</p><pre class="language-text"><code># kubectl -n wordpress-mysql apply -f /tmp/wordpress-mysql-nfs/wordpress-deployment.yml        
deployment.apps/wordpress created
</code></pre><p>Refresh the page in the browser to confirm that WordPress is now accessible and that the image in the blog post
has survived the shutdown.</p><p><img src="/Docker-Synergy/assets/img/wordpress-restored.81c4999f.png" alt=""View restored post"" title="Figure. View restored post"></p><p><strong>Figure.</strong> View restored post</p><h2 id="test-persistence-in-mysql"><a href="#test-persistence-in-mysql" aria-hidden="true" class="header-anchor">#</a> Test persistence in MySQL</h2><p>A similar procedure can be performed for MySQL. While assets such as images, CSS files, etc are stored in the
WordPress volume, information about users, posts, comments, tags, etc are stored in the MySQL database.
It is possible to browse the tables in the database and identify the rows related to the blog post you created.</p><p>Shut down MySQL as follows:</p><pre class="language-text"><code># kubectl -n wordpress-mysql delete -f /tmp/wordpress-mysql-nfs/mysql-deployment.yml
deployment.apps &quot;wordpress-mysql&quot; deleted
</code></pre><p>Refresh the page for your blog post, and you will see that WordPress can no longer connect to the database:</p><p><img src="/Docker-Synergy/assets/img/mysql-cant-connect.c015abc3.png" alt=""Cannot connect to MySQL"" title="Figure. Cannot connect to MySQL"></p><p><strong>Figure.</strong> Cannot connect to MySQL</p><p>Restore the MySQL deployment:</p><pre class="language-text"><code># ubectl -n wordpress-mysql apply -f /tmp/wordpress-mysql-nfs/mysql-deployment.yml
deployment.apps/wordpress-mysql created
</code></pre><p>Refresh the page in the browser to confirm that WordPress can now access the database and that the blog post
has survived the database shutdown.</p><p><img src="/Docker-Synergy/assets/img/mysql-restored.9c3ebf17.png" alt=""Figure. Check after MySQL restored"" title="Figure. Check after MySQL restored"></p><p><strong>Figure.</strong> Check after MySQL restored</p></div><div class="content edit-link"><a href="https://github.com/HewlettPackard/Docker-Synergy/edit/devel/docs-src/storage/wordpress-mysql-nfs.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/Docker-Synergy/storage/nfs-provisioner.html" class="prev">
          Deploying the NFS provisioner for Kubernetes
        </a></span><span class="next"><a href="/Docker-Synergy/deploy-win/deploying-windows-workers.html">
          Introduction to deploying Windows VM workers
        </a> →
      </span></p></div></div></div></div>
    <script src="/Docker-Synergy/assets/js/app.a57224f5.js" defer></script><script src="/Docker-Synergy/assets/js/1.cdb2fd8c.js" defer></script>
  </body>
</html>
