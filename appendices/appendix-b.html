<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Appendix B: Using customer supplied certificates for UCP and DTR | HPE Enterprise Containers</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/Docker-Synergy/assets/css/0.styles.c33c7542.css" as="style"><link rel="preload" href="/Docker-Synergy/assets/js/app.34d76198.js" as="script"><link rel="preload" href="/Docker-Synergy/assets/js/31.37da060c.js" as="script"><link rel="prefetch" href="/Docker-Synergy/assets/js/10.4de737a2.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/100.a6cb7000.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/101.4f80af5a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/102.4c2b5952.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/103.3506b1eb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/104.6e609a9d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/105.b2585249.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/106.358b375a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/107.34b0da8c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/108.f8ce2cb4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/109.ead6add2.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/11.ecd77249.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/110.a9b5e11c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/111.b0306c91.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/112.8e77bb0b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/113.b52b89d0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/12.5c573839.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/13.2f9195e5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/14.9a39d87d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/15.f6fa6a0d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/16.27eb672d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/17.47058c6f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/18.8774178d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/19.78f992af.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/2.be8c3dfc.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/20.301380e0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/21.66b11733.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/22.bc770be7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/23.1b978569.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/24.93dae8f3.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/25.5a30e296.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/26.fee397ed.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/27.57bc96ef.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/28.c4cadbb3.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/29.de8c4c9a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/3.d303b3f5.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/30.18325d1b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/32.2c551203.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/33.c3d5c7f6.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/34.b1936c47.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/35.445eec65.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/36.6df590fa.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/37.8db7e21d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/38.2a38b46e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/39.87861f33.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/4.9bea767a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/40.ba25a586.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/41.5b6f8054.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/42.adf1fa14.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/43.7a6a7498.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/44.26f4ca2e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/45.4d55e5b4.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/46.4ad45706.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/47.02ee5daf.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/48.71f3171b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/49.a26feaf1.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/5.822b01be.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/50.de7edabf.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/51.fa2da60e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/52.659891ff.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/53.5a873fb7.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/54.4811db4a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/55.9cce4fb6.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/56.dbe3cbdd.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/57.7f3a707a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/58.9bd4c197.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/59.18d89016.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/6.8d3d69e8.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/60.6fee6984.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/61.b36fdc6e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/62.3171ef49.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/63.6ebecb7d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/64.023930ed.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/65.75e5cb4a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/66.e3c26462.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/67.2fe57dc8.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/68.67b8bd42.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/69.bff05089.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/7.d2fa7c5e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/70.2c29547b.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/71.a19fe798.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/72.8501c095.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/73.4ba9ad9d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/74.eeed5f21.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/75.9ec2bbdc.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/76.b6c0bf96.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/77.3ef1ecdd.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/78.71534c55.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/79.dc16d049.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/8.feb04e4d.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/80.30377444.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/81.b046d492.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/82.f918a47a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/83.964e7cdb.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/84.9f947c1e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/85.1e622610.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/86.d6ce9bee.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/87.c2fc8cea.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/88.d58e515a.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/89.b1a84af6.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/9.e7e3eb57.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/90.35cc154f.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/91.de01bb54.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/92.2583303e.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/93.860f644c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/94.ad464436.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/95.73c11e79.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/96.a228768c.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/97.2a628cd0.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/98.8689ddab.js"><link rel="prefetch" href="/Docker-Synergy/assets/js/99.fc3273a9.js">
    <link rel="stylesheet" href="/Docker-Synergy/assets/css/0.styles.c33c7542.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Docker-Synergy/" class="home-link router-link-active"><!----> <span class="site-name">HPE Enterprise Containers</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div> <a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Docker-Synergy/" class="nav-link">Home</a></div><div class="nav-item"><a href="/Docker-Synergy/blog/" class="nav-link">Blog</a></div> <a href="https://github.com/HewlettPackard/Docker-Synergy" target="_blank" rel="noopener noreferrer" class="repo-link">
    Contribute!
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Release notes</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution overview</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution components</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Preparing the environment</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring the core components</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Overview of the playbooks</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying core components</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Post deployment</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Configuring Storage</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Windows VM workers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying bare metal workers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Sysdig monitoring</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Splunk</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Kubernetes</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Deploying Prometheus and Grafana on Docker Swarm</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Backup and restore</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution lifecycle management</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Appendices</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/Docker-Synergy/appendices/appendix-a.html" class="sidebar-link">Appendix A: Software Licenses</a></li><li><a href="/Docker-Synergy/appendices/appendix-b.html" class="active sidebar-link">Appendix B: Using customer supplied certificates for UCP and DTR</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Docker-Synergy/appendices/appendix-b.html#generating-and-testing-certificates" class="sidebar-link">Generating and testing certificates</a></li><li class="sidebar-sub-header"><a href="/Docker-Synergy/appendices/appendix-b.html#verify-your-certificates" class="sidebar-link">Verify your certificates</a></li></ul></li><li><a href="/Docker-Synergy/appendices/appendix-c.html" class="sidebar-link">Appendix C: Enabling SSL between the universal forwarders and the Splunk indexers using your certificates</a></li><li><a href="/Docker-Synergy/appendices/appendix-d.html" class="sidebar-link">Appendix D: How to check that certs were deployed correctly</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="appendix-b-using-customer-supplied-certificates-for-ucp-and-dtr"><a href="#appendix-b-using-customer-supplied-certificates-for-ucp-and-dtr" aria-hidden="true" class="header-anchor">#</a> Appendix B: Using customer supplied certificates for UCP and DTR</h1> <p>Table 32 lists the variables used when configuring customer supplied certificates for UCP and DTR.</p> <p><strong>Table 32.</strong> Customer certs variables</p> <table><thead><tr><th style="text-align:left">Variable</th> <th style="text-align:left">File</th> <th style="text-align:left">Description</th></tr></thead> <tbody><tr><td style="text-align:left">ucp_certs_dir</td> <td style="text-align:left">group_vars/all/vars</td> <td style="text-align:left">-   If <strong>ucp_certs_dir</strong> is not defined, UCP is installed with self-signed certificates and DTR is installed with the <code>--ucp-insecure-tls</code> switch<br>- If <strong>ucp_certs_dir</strong> is defined, this is a folder on the Ansible machine that must contain 3 files:<br>  * <code>ca.pem</code>, the root CA certificate in PEM format<br>  *   <code>cert.pem</code>, the server certificate optionally followed by intermediate CAs<br>    *   <code>key.pem</code>, the private key that comes with the <code>cert.pem</code> certificates</td></tr> <tr><td style="text-align:left">dtr_certs_dir</td> <td style="text-align:left">group_vars/all/vars</td> <td style="text-align:left">-   If <strong>dtr_certs_dir</strong> is not defined, DTR is installed with self-signed certificates<br>-   If <strong>dtr_certs_dir</strong> is defined, this is a folder on the Ansible machine that must contain 3 files:<br>    *   <code>ca.pem</code>, the root CA certificate in PEM format<br>    *   <code>cert.pem</code>, the server certificate optionally followed by intermediate CAs<br>    *   <code>key.pem</code>, the private key that comes with the <code>cert.pem</code> certificates</td></tr></tbody></table> <p><strong>Note:</strong></p> <p>The installation will fail if the <code>ca.pem</code>, <code>cert.pem</code> and <code>key.pem</code> files cannot be found in the folders designated by <code>dtr_certs_dir</code> and <code>ucp_certs_dir</code> or if they don't constitute valid certificates.</p> <p>The certificates should specify the names of the FQDNs of the load balancer and the FQDNs of the VMs themselves. This applies to both the UCP server certificate and the DTR server certificate.</p> <h2 id="generating-and-testing-certificates"><a href="#generating-and-testing-certificates" aria-hidden="true" class="header-anchor">#</a> Generating and testing certificates</h2> <p>In the example described here we have a root CA named <code>Example root CA</code> and an intermediate CA named <code>Intermediate CA valid 3 years</code>. The intermediate CA signs the server certificates for UCP and DTR.</p> <p>Below is the start of the output displayed by running the <code>openssl x509</code> utility against the <code>ca.pem</code> file (the root CA certificate).</p> <div class="language- extra-class"><pre class="language-text"><code>
[root@ansible ucp_certs]# openssl x509 -text -noout -in ca.pem|head -14
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            0d:07:ca:ea:00:37:77:6e:25:e0:18:3e:0e:db:80:0f:11:cb:1b:3f
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=Example Root CA
        Validity
            Not Before: Apr 24 20:12:01 2018 GMT
            Not After : Apr 21 20:12:30 2028 GMT
        Subject: CN=Example Root CA
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (4096 bit)
</code></pre></div><p>Here is an excerpt from the example <code>ca.pem</code> file:</p> <div class="language- extra-class"><pre class="language-text"><code>-----BEGIN CERTIFICATE-----
MIIFJTCCAw2gAwIBAgIUDQfK6gA3d24l4Bg+DtuADxHLGz8wDQYJKoZIhvcNAQEL
BQAwGjEYMBYGA1UEAxMPRXhhbXBsZSBSb290IENBMB4XDTE4MDQyNDIwMTIwMVoX
...
...
uXzYbCtU6Jt9B3fayAeWWswQv+jQSzuuA3re0M1x838iIZWDx93f4yLJWLJl7xsY
btvKBmqKDCsAqsQLFLnNj/JyYq4e9a6Xxcyn9FXNpzuEsfjfNGHn+csY+w3f987T
MNviy376xZbyAc1CV5kgmnZzjU5bDkgT8Q==
-----END CERTIFICATE-----
</code></pre></div><p>The <code>cert.pem</code> file should contain the server certificate itself, followed by your intermediate CA's certificate. The following example shows how to extract the intermediate CA certificate from <code>cert.pem</code> and to save it to a file named <code>intca.pem</code>. Using the <code>openssl x509</code> utility, you can display the content of the <code>intca.pem</code> file in human readable form. This certificate was signed by the example CA above (<code>Issuer = 'Example Root CA'</code>).</p> <div class="language- extra-class"><pre class="language-text"><code>[root@ansible ucp_certs]# openssl x509 -text -noout -in intca.pem|head -14
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            6b:1e:0c:86:20:cf:f0:88:d2:52:0d:5d:b9:56:fa:91:87:a0:49:18
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=Example Root CA
        Validity
            Not Before: Apr 24 20:12:09 2018 GMT
            Not After : Apr 23 20:12:39 2021 GMT
        Subject: CN=Intermediate CA valid 3 years
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (4096 bit)
</code></pre></div><p>Here is an excerpt from the <code>incta.pem</code> file showing the example Intermediate CA certificate:</p> <div class="language- extra-class"><pre class="language-text"><code>-----BEGIN CERTIFICATE-----
MIIFcjCCA1qgAwIBAgIUax4MhiDP8IjSUg1duVb6kYegSRgwDQYJKoZIhvcNAQEL
BQAwGjEYMBYGA1UEAxMPRXhhbXBsZSBSb290IENBMB4XDTE4MDQyNDIwMTIwOVoX
...
...
o2tL5nwR7ROiAr/kk9MIRzWrLNbc4cYth7jEjspU9dBqsXgsTozzWlwqI9ybZwvL
Ni1JnZandVlyQdoOaB2M/1DNFfKvwW3JeArKvDA9j95n/BWFTjoZ+YOz9pYit6T7
1GCGu3be
-----END CERTIFICATE-----
</code></pre></div><p>The <code>openssl x509</code> utility will only decrypt the first certificate found in <code>cert.pem</code>, so you don't need to extract the server certificate from <code>cert.pem</code>. In this example, the server certificate is signed by the intermediate CA above. Note the <code>Subject Alternate Names: hpe-ucp.cloudra.local</code> is the FQDN of the UCP load balancer, and the other names are those of the UCP instances (<code>hpe-ucp01.cloudra.local</code>, <code>hpe-ucp02.clodura.local</code>, <code>hpe-ucp03.cloudra.local</code>).</p> <div class="language- extra-class"><pre class="language-text"><code>[root@ansible ucp_certs]# openssl x509 -text -noout -in server.pem
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            25:d9:f8:1d:9b:1d:23:f1:21:56:54:f2:43:cc:4f:0e:73:22:be:ec
    Signature Algorithm: sha256WithRSAEncryption
        Issuer: CN=Intermediate CA valid 3 years
        Validity
            Not Before: Apr 24 20:17:30 2018 GMT
            Not After : Apr 24 20:18:00 2019 GMT
        Subject: O=HPE, OU=CloudRA Team, CN=hpe-ucp.cloudra.local
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (2048 bit)
                CA Issuers - URI:http://localhost:8200/v1/intca
      ( portions removed )
 
            X509v3 Subject Alternative Name:
                DNS:hpe-ucp.cloudra.local, DNS:hpe-ucp01.cloudra.local, DNS:hpe-ucp02.cloudra.local, DNS:hpe-ucp03.cloudra.local
</code></pre></div><p>The following excerpts from <code>cert.pem</code> show the first certificate which is the server certificate itself and the second certificate which is the intermediate CA's certificate.</p> <div class="language- extra-class"><pre class="language-text"><code>-----BEGIN CERTIFICATE-----
MIIFGTCCAwGgAwIBAgIUJdn4HZsdI/EhVlTyQ8xPDnMivuwwDQYJKoZIhvcNAQEL
BQAwKDEmMCQGA1UEAxMdSW50ZXJtZWRpYXRlIENBIHZhbGlkIDMgeWVhcnMwHhcN
...
...
s0R4I3Qnc50oNISng5l7wW1d4RMMwmXQhG1H5QKAUjHfJXH4bNtIzKxw/zGTVr4Z
llYKbEwJcgAvvfkn+w==
-----END CERTIFICATE-----
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>-----BEGIN CERTIFICATE-----
MIIFcjCCA1qgAwIBAgIUax4MhiDP8IjSUg1duVb6kYegSRgwDQYJKoZIhvcNAQEL
BQAwGjEYMBYGA1UEAxMPRXhhbXBsZSBSb290IENBMB4XDTE4MDQyNDIwMTIwOVoX
...
...
Ni1JnZandVlyQdoOaB2M/1DNFfKvwW3JeArKvDA9j95n/BWFTjoZ+YOz9pYit6T7
1GCGu3be
-----END CERTIFICATE-----
</code></pre></div><p>Finally, here is an excerpt from <code>key.pem</code>, the private key that goes with the server certificate.</p> <div class="language- extra-class"><pre class="language-text"><code>-----BEGIN RSA PRIVATE KEY-----
MIIEpQIBAAKCAQEA5rmmb52ufE80a3cXhY2HSRZNazb7/fipXY1rZ+U5+rJv9BN5
d/X3NTroSE8/PvoS/maGkHCnURGNqbu/G2umKN/tm/eSpDY861YnGWxj+bc0gtiU
...
...
A0SGidSMk3hFX1Iaftgx4EUGbrzZO7I8M5RO64U1aMFNFyj4XghJ2mZTdNelwNBw
pr/fYulyi5lYPalQHYH3OyvNqQQ3arEbTbZp8hEyY0gxtZRXmmaoqOY=
-----END RSA PRIVATE KEY-----
</code></pre></div><h2 id="verify-your-certificates"><a href="#verify-your-certificates" aria-hidden="true" class="header-anchor">#</a> Verify your certificates</h2> <p>The playbooks do not verify the validity of the certificate files you supply so you should verify them manually before you start your deployment.</p> <h3 id="verify-that-the-private-and-the-server-cert-match"><a href="#verify-that-the-private-and-the-server-cert-match" aria-hidden="true" class="header-anchor">#</a> Verify that the private and the server cert match</h3> <p>On the Ansible box, run the following commands:</p> <div class="language- extra-class"><pre class="language-text"><code>ckcert=$(openssl x509 -noout -modulus -in cert.pem | openssl md5)
ckkey=$(openssl rsa -noout -modulus -in key.pem| openssl md5)
if [ &quot;$ckkey&quot; == &quot;$ckcert&quot; ] ; then echo &quot;Private key and Certificate match&quot; ; else echo &quot;STOP! Private Key and Certificate don't match&quot; ; fi

</code></pre></div><h3 id="verify-that-the-server-certificate-was-signed-by-the-ca"><a href="#verify-that-the-server-certificate-was-signed-by-the-ca" aria-hidden="true" class="header-anchor">#</a> Verify that the server certificate was signed by the CA</h3> <p>Extract all but the first certificate from <code>cert.pem</code> ( i.e. extract the certs for the intermediate CA authorities) into the file <code>int.pem</code></p> <div class="language- extra-class"><pre class="language-text"><code>sed -e '1,/-----END CERTIFICATE-----/d' cert.pem &gt;intca.pem
</code></pre></div><p>Combine <code>intca.pem</code> and <code>ca.pem</code> to form <code>cachain.pem</code>:</p> <div class="language- extra-class"><pre class="language-text"><code>cat intca.pem ca.pem &gt; cachain.pem
</code></pre></div><p>Finally, verify that <code>cert.pem</code> was signed by the CA or by an intermediate CA:</p> <div class="language- extra-class"><pre class="language-text"><code>openssl verify -verbose -CAfile cachain.pem  cert.pem
</code></pre></div><p>A successful check will generate output similar to:</p> <div class="language- extra-class"><pre class="language-text"><code>[root@ansible ucp_certs]# cat intca.pem ca.pem &gt; cachain.pem
[root@ansible ucp_certs]# openssl verify -verbose -CAfile cachain.pem  cert.pem
cert.pem: OK
</code></pre></div><p>An unsuccessful check will generate output similar to:</p> <div class="language- extra-class"><pre class="language-text"><code>[root@ansible ucp_certs]# openssl verify -verbose -CAfile cachain.pem  certsignedbyanotherca.pem
certsignedbyanotherca.pem: O = HPE, OU = CloudRA Team, CN = hpe-ucp.cloudra.local
error 20 at 0 depth lookup:unable to get local issuer certificate
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/HewlettPackard/Docker-Synergy/edit/gh-pages/docs-src/appendices/appendix-b.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/Docker-Synergy/appendices/appendix-a.html" class="prev">
          Appendix A: Software Licenses
        </a></span> <span class="next"><a href="/Docker-Synergy/appendices/appendix-c.html">
          Appendix C: Enabling SSL between the universal forwarders and the Splunk indexers using your certificates
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/Docker-Synergy/assets/js/app.34d76198.js" defer></script><script src="/Docker-Synergy/assets/js/31.37da060c.js" defer></script>
  </body>
</html>
